import{a as z,b as Q}from"./chunk-CUYXMCNI.js";import{u as B,v as F}from"./chunk-2CEUD3GB.js";import{Ba as w,Ca as M,Ga as S,Ma as P,Ya as k,Za as x,fb as o,ga as c,gb as a,gc as T,ha as h,hb as _,ia as b,ja as y,jd as I,lb as Y,ld as O,md as V,nb as r,nd as E,od as D,pd as L,sb as p,tb as u,ub as f,wd as R,yb as l,zb as X}from"./chunk-XJQRPAJU.js";var A=["mapContainer"],W=["mapViewport"],H=["mapContent"],N=["mapSvg"],at=(()=>{class g{constructor(t){this.phaseService=t,this.isDarkMode=!1,this.scale=1,this.posX=0,this.posY=0,this.startPosX=0,this.startPosY=0,this.startClientX=0,this.startClientY=0,this.isPanning=!1,this.initialDistance=0,this.initialScale=1,this.minScale=.5,this.maxScale=3;let i=localStorage.getItem("darkMode");i&&(this.isDarkMode=JSON.parse(i)),this.applyTheme()}ngOnInit(){}ngAfterViewInit(){this.setupMapInteractions(),setTimeout(()=>this.resetView(),100)}onResize(){this.resetView()}toggleDarkMode(){this.isDarkMode=!this.isDarkMode,this.applyTheme(),localStorage.setItem("darkMode",JSON.stringify(this.isDarkMode))}applyTheme(){this.isDarkMode?(document.body.classList.add("dark-theme"),document.body.classList.remove("light-theme")):(document.body.classList.add("light-theme"),document.body.classList.remove("dark-theme"))}returnToWorkPhase(){this.phaseService.transitionToWorkPhase()}onSectionChange(t){console.log("Secci\xF3n seleccionada:",t)}zoomIn(){this.scale=Math.min(this.maxScale,this.scale+.2),this.updateTransform()}zoomOut(){this.scale=Math.max(this.minScale,this.scale-.2),this.updateTransform()}resetView(){this.scale=1,this.posX=0,this.posY=0,this.updateTransform()}setupMapInteractions(){let t=this.mapSvg.nativeElement;t.addEventListener("mousedown",this.onMouseDown.bind(this)),window.addEventListener("mousemove",this.onMouseMove.bind(this)),window.addEventListener("mouseup",this.onMouseUp.bind(this)),t.addEventListener("wheel",this.onWheel.bind(this)),t.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!1}),window.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),window.addEventListener("touchend",this.onTouchEnd.bind(this))}onMouseDown(t){t.preventDefault(),this.isPanning=!0,this.startClientX=t.clientX,this.startClientY=t.clientY,this.startPosX=this.posX,this.startPosY=this.posY}onMouseMove(t){if(!this.isPanning)return;let i=t.clientX-this.startClientX,e=t.clientY-this.startClientY;this.posX=this.startPosX+i,this.posY=this.startPosY+e,this.updateTransform()}onMouseUp(){this.isPanning=!1}onWheel(t){t.preventDefault();let i=this.mapSvg.nativeElement.getBoundingClientRect(),e=t.clientX-i.left,n=t.clientY-i.top,s=this.mapSvg.nativeElement.createSVGPoint();s.x=e,s.y=n;let m=t.deltaY>0?-.1:.1,d=Math.max(this.minScale,Math.min(this.maxScale,this.scale+m));if(d!==this.scale){let v=d/this.scale,C=e-this.posX,q=n-this.posY;this.posX=e-C*v,this.posY=n-q*v,this.scale=d}this.updateTransform()}onTouchStart(t){if(t.preventDefault(),t.touches.length===1)this.isPanning=!0,this.startClientX=t.touches[0].clientX,this.startClientY=t.touches[0].clientY,this.startPosX=this.posX,this.startPosY=this.posY;else if(t.touches.length===2){this.isPanning=!1;let i=t.touches[0].clientX-t.touches[1].clientX,e=t.touches[0].clientY-t.touches[1].clientY;this.initialDistance=Math.sqrt(i*i+e*e),this.initialScale=this.scale,this.startClientX=(t.touches[0].clientX+t.touches[1].clientX)/2,this.startClientY=(t.touches[0].clientY+t.touches[1].clientY)/2}}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isPanning){let i=t.touches[0].clientX-this.startClientX,e=t.touches[0].clientY-this.startClientY;this.posX=this.startPosX+i,this.posY=this.startPosY+e,this.updateTransform()}else if(t.touches.length===2){let i=t.touches[0].clientX-t.touches[1].clientX,e=t.touches[0].clientY-t.touches[1].clientY,n=Math.sqrt(i*i+e*e),s=Math.max(this.minScale,Math.min(this.maxScale,this.initialScale*(n/this.initialDistance))),m=(t.touches[0].clientX+t.touches[1].clientX)/2,d=(t.touches[0].clientY+t.touches[1].clientY)/2,v=m-this.startClientX,C=d-this.startClientY;this.posX=this.startPosX+v,this.posY=this.startPosY+C,this.scale=s,this.updateTransform()}}onTouchEnd(){this.isPanning=!1}updateTransform(){}static{this.\u0275fac=function(i){return new(i||g)(S(B))}}static{this.\u0275cmp=P({type:g,selectors:[["app-my-island"]],viewQuery:function(i,e){if(i&1&&(p(A,5),p(W,5),p(H,5),p(N,5)),i&2){let n;u(n=f())&&(e.mapContainer=n.first),u(n=f())&&(e.mapViewport=n.first),u(n=f())&&(e.mapContent=n.first),u(n=f())&&(e.mapSvg=n.first)}},hostBindings:function(i,e){i&1&&r("resize",function(){return e.onResize()},!1,w)},decls:33,vars:3,consts:[["mapContainer",""],["mapViewport",""],["mapSvg",""],["mapContent",""],[1,"my-island-container"],[3,"sectionChange","activeSection"],["color","primary",1,"island-toolbar"],[1,"toolbar-spacer"],["mat-icon-button","","aria-label","Alternar modo oscuro",3,"click"],[1,"island-content"],[1,"island-map-container"],[1,"island-map-viewport"],["viewBox","0 0 1000 1000","preserveAspectRatio","xMidYMid meet",1,"island-map-svg"],[1,"island-map-content"],["href","assets/images/island/mapa.png","x","0","y","0","width","1000","height","1000","preserveAspectRatio","xMidYMid meet"],[1,"island-map-controls"],["mat-mini-fab","","color","primary","aria-label","Acercar",3,"click"],["mat-mini-fab","","color","primary","aria-label","Alejar",3,"click"],["mat-mini-fab","","color","primary","aria-label","Restablecer vista",3,"click"],["mat-raised-button","","color","primary",1,"return-button",3,"click"]],template:function(i,e){if(i&1){let n=Y();o(0,"div",4)(1,"app-navigation-rail",5),r("sectionChange",function(m){return c(n),h(e.onSectionChange(m))}),a(),o(2,"mat-toolbar",6)(3,"span"),l(4,"Mi Isla"),a(),_(5,"span",7),o(6,"button",8),r("click",function(){return c(n),h(e.toggleDarkMode())}),o(7,"mat-icon"),l(8),a()()(),o(9,"div",9)(10,"div",10,0)(12,"div",11,1),b(),o(14,"svg",12,2)(16,"g",13,3),_(18,"image",14),a()()(),y(),o(19,"div",15)(20,"button",16),r("click",function(){return c(n),h(e.zoomIn())}),o(21,"mat-icon"),l(22,"add"),a()(),o(23,"button",17),r("click",function(){return c(n),h(e.zoomOut())}),o(24,"mat-icon"),l(25,"remove"),a()(),o(26,"button",18),r("click",function(){return c(n),h(e.resetView())}),o(27,"mat-icon"),l(28,"home"),a()()()(),o(29,"button",19),r("click",function(){return c(n),h(e.returnToWorkPhase())}),o(30,"mat-icon"),l(31,"work"),a(),l(32," Terminar fase de recreo "),a()()()}i&2&&(M(),x("activeSection","island"),M(7),X(e.isDarkMode?"light_mode":"dark_mode"),M(8),k("transform","translate("+e.posX+","+e.posY+") scale("+e.scale+")"))},dependencies:[T,R,E,O,I,V,L,D,Q,z,F],styles:[".my-island-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;background-color:var(--app-light-background, #FFFFFF);overflow:hidden;padding-left:72px}.dark-theme[_ngcontent-%COMP%]   .my-island-container[_ngcontent-%COMP%]{background-color:var(--app-dark-background, #121212)}.island-toolbar[_ngcontent-%COMP%]{background-color:var(--app-light-primary, #7b965d);color:#fff;z-index:10}.dark-theme[_ngcontent-%COMP%]   .island-toolbar[_ngcontent-%COMP%]{background-color:var(--app-dark-primary, #5a7144)}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.island-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;position:relative;overflow:hidden;background-color:#1e88e5}.island-map-container[_ngcontent-%COMP%]{flex:1;position:relative;overflow:hidden;touch-action:none}.island-map-viewport[_ngcontent-%COMP%]{width:100%;height:100%;overflow:hidden;position:relative;touch-action:none}.island-map-svg[_ngcontent-%COMP%]{width:100%;height:100%;-webkit-user-select:none;user-select:none;touch-action:none}.island-map-content[_ngcontent-%COMP%]{transform-origin:center center;will-change:transform;touch-action:none}.island-map-controls[_ngcontent-%COMP%]{position:absolute;bottom:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:5}.return-button[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:20px;z-index:5;background-color:var(--app-light-primary, #7b965d)}.interactive-element[_ngcontent-%COMP%]{cursor:pointer;transition:transform .2s ease}.interactive-element[_ngcontent-%COMP%]:hover{transform:scale(1.1)}@media (max-width: 767px){.my-island-container[_ngcontent-%COMP%]{padding-left:0;padding-bottom:56px}.island-map-controls[_ngcontent-%COMP%]{bottom:80px;right:10px}.return-button[_ngcontent-%COMP%]{bottom:70px;left:10px;right:10px;width:calc(100% - 20px)}}"]})}}return g})();export{at as MyIslandComponent};
/**i18n:cbc6eedd78daabc21d38dc76dc1d9c98cb25f2a080c64096148af3a26e2a8f0f*/
